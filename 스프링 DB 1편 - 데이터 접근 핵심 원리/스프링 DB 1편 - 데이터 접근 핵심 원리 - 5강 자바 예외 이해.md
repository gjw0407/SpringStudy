# ìŠ¤í”„ë§ DB 1í¸ - ë°ì´í„° ì ‘ê·¼ í•µì‹¬ ì›ë¦¬ - 5ê°• ìë°” ì˜ˆì™¸ ì´í•´

# ì˜ˆì™¸ ê³„ì¸µ

![Untitled](https://user-images.githubusercontent.com/61227459/187442151-ccd79a7a-cf26-4d82-b062-abb1ea7f0674.png)

- `Error` : ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì‹œìŠ¤í…œ ì˜ˆì™¸ â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œìëŠ” ì´ ì˜ˆì™¸ë¥¼ ì¡ìœ¼ë ¤ê³  í•´ì„œëŠ” ì•ˆë¨
    - ìƒìœ„ ì˜ˆì™¸ë¥¼ `catch`ë¡œ ì¡ìœ¼ë©´ ê·¸ í•˜ìœ„ ì˜ˆì™¸ê¹Œì§€ í•¨ê»˜ ì¡ìŒ
        - ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì—ì„œëŠ” `Throwable` ì˜ˆì™¸ë„ ì¡ìœ¼ë©´ ì•ˆë˜ëŠ”ë°, ì•ì„œ ì´ì•¼ê¸°í•œ `Error` ì˜ˆì™¸ë„ í•¨ê»˜ ì¡ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸
    - ì–¸ì²´í¬ ì˜ˆì™¸
- `SQLException`, `IOException`ì€ ì²´í¬ ì˜ˆì™¸
- `RuntimeException`ì€ ì–¸ì²´í¬ ì˜ˆì™¸, ëŸ°íƒ€ì¸ ì˜ˆì™¸

## ì˜ˆì™¸ ê¸°ë³¸ ê·œì¹™

1. ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜ ë˜ì§
2. ì˜ˆì™¸ë¥¼ ì¡ê±°ë‚˜ ë˜ì§ˆ ë•Œ ì§€ì •í•œ ì˜ˆì™¸ë¿ë§Œ ì•„ë‹ˆë¼ ê·¸ ì˜ˆì™¸ì˜ ìì‹ë“¤ë„ í•¨ê»˜ ì²˜ë¦¬ ë¨

# ì²´í¬ ì˜ˆì™¸

## ì˜ˆì™¸ ì²˜ë¦¬(catch)

```java
/**
* Exceptionì„ ìƒì†ë°›ì€ ì˜ˆì™¸ëŠ” ì²´í¬ ì˜ˆì™¸ê°€ ëœë‹¤.
*/
static class MyCheckedException extends Exception {
	public MyCheckedException(String message) {
		super(message);
	}
}
/**
* Checked ì˜ˆì™¸ëŠ”
* ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜, ë˜ì§€ê±°ë‚˜ ë‘˜ì¤‘ í•˜ë‚˜ë¥¼ í•„ìˆ˜ë¡œ ì„ íƒí•´ì•¼ í•œë‹¤.
*/
static class Service {
	Repository repository = new Repository();
	/**
	* ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œ
	*/
	public void callCatch() {
		try {
			repository.call();
		} catch (MyCheckedException e) {
			//ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§
			log.info("ì˜ˆì™¸ ì²˜ë¦¬, message={}", e.getMessage(), e);
		}
	}
	/**
	* ì²´í¬ ì˜ˆì™¸ë¥¼ ë°–ìœ¼ë¡œ ë˜ì§€ëŠ” ì½”ë“œ
	* ì²´í¬ ì˜ˆì™¸ëŠ” ì˜ˆì™¸ë¥¼ ì¡ì§€ ì•Šê³  ë°–ìœ¼ë¡œ ë˜ì§€ë ¤ë©´ throws ì˜ˆì™¸ë¥¼ ë©”ì„œë“œì— í•„ìˆ˜ë¡œ
	ì„ ì–¸í•´ì•¼í•œë‹¤.
	*/
	public void callThrow() throws MyCheckedException {
		repository.call();
	}
}
```

```java
@Test
void checked_catch() {
	Service service = new Service();
	service.callCatch();
}
```

1. test â†’ `service.callCatch()` â†’ `repository.call()` â†’ [ì˜ˆì™¸ ë°œìƒ, ë˜ì§]
2. test â† `service.callCatch()` â† [ì˜ˆì™¸ ì²˜ë¦¬] â† `repository.call()`
3. test [ì •ìƒ íë¦„] â† `service.callCatch()` â† `repository.call()`

<aside>
ğŸ’¡ `catch`ëŠ” í•´ë‹¹ íƒ€ì…ê³¼ í•˜ìœ„ íƒ€ì…ì„ ì¡ìŒ

</aside>

## ì˜ˆì™¸ë¥¼ ë˜ì§(throw)

```java
@Test
void checked_throw() {
	Service service = new Service();
	assertThatThrownBy(() -> service.callThrow())
	.isInstanceOf(MyCheckedException.class);
}

public void callThrow() throws MyCheckedException {
	repository.call();
}
```

1. test â†’ `service.callThrow()` â†’ `repository.call()`[ì˜ˆì™¸ ë°œìƒ, ë˜ì§]
2. test â† `service.callThrow()` [ì˜ˆì™¸ ë˜ì§] â† `repository.call()`
3. test [ì˜ˆì™¸ ë„ì°©] â† `service.callThrow()` â† `repository.call()`

<aside>
ğŸ’¡ `throws`ë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì»´íŒŒì¼ ì˜¤ë¥˜

</aside>

## ì¥ë‹¨ì 

- ì¥ì : ì‹¤ìˆ˜ë¡œ ì˜ˆì™¸ë¥¼ ëˆ„ë½í•˜ì§€ ì•Šë„ë¡ ì»´íŒŒì¼ëŸ¬ë¥¼ í†µí•´ ë¬¸ì œë¥¼ ì¡ì•„ì£¼ëŠ” ì•ˆì „ ì¥ì¹˜
- ë‹¨ì : ëª¨ë“  ì²´í¬ ì˜ˆì™¸ë¥¼ ë°˜ë“œì‹œ ì¡ê±°ë‚˜ ë˜ì§€ë„ë¡ ì²˜ë¦¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë²ˆê±°ë¡œì›€

# ì–¸ì²´í¬ ì˜ˆì™¸

> ì»´íŒŒì¼ëŸ¬ê°€ ì˜ˆì™¸ë¥¼ ì²´í¬í•˜ì§€ ì•ŠìŒ
> 

## ì²´í¬ vs ì–¸ì²´í¬

- ì²´í¬ ì˜ˆì™¸: ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ í•­ìƒ `throws`ì— ë˜ì§€ëŠ” ì˜ˆì™¸ë¥¼ ì„ ì–¸
- ì–¸ì²´í¬ ì˜ˆì™¸: ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ë„ `throws`ë¥¼ ìƒëµ ê°€ëŠ¥
- ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ì—†ì„ ë•Œ ì˜ˆì™¸ë¥¼ ë°–ìœ¼ë¡œ ë˜ì§€ëŠ” ë¶€ë¶„ì— ì°¨ì´ ë°œìƒ
- í•„ìˆ˜ë¡œ ì„ ì–¸ vs ìƒëµ ê°€ëŠ¥ ì°¨ì´

```java
/**
* í•„ìš”í•œ ê²½ìš° ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ë©´ ëœë‹¤.
*/
public void callCatch() {
	try {
		repository.call();
	} catch (MyUncheckedException e) {
		//ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§
		log.info("ì˜ˆì™¸ ì²˜ë¦¬, message={}", e.getMessage(), e);
	}
}
/**
* ì˜ˆì™¸ë¥¼ ì¡ì§€ ì•Šì•„ë„ ëœë‹¤. ìì—°ìŠ¤ëŸ½ê²Œ ìƒìœ„ë¡œ ë„˜ì–´ê°„ë‹¤.
* ì²´í¬ ì˜ˆì™¸ì™€ ë‹¤ë¥´ê²Œ throws ì˜ˆì™¸ ì„ ì–¸ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
*/
public void callThrow() {
	repository.call();
}
```

## ì¥ë‹¨ì 

- ì¥ì :
    - ì‹ ê²½ ì“°ê³  ì‹¶ì§€ ì•Šì€ ì–¸ì²´í¬ ì˜ˆì™¸ë¥¼ ë¬´ì‹œ ê°€ëŠ¥
    - ì²´í¬ ì˜ˆì™¸ì˜ ê²½ìš° ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” ì˜ˆì™¸ë¥¼ ë°–ìœ¼ë¡œ ë˜ì§€ë ¤ë©´ í•­ìƒ throws ì˜ˆì™¸ ë¥¼ ì„ ì–¸í•´ì•¼ í•˜ì§€ë§Œ, ì–¸ì²´í¬ ì˜ˆì™¸ëŠ” ì´ ë¶€ë¶„ì„ ìƒëµ ê°€ëŠ¥
    - ì‹ ê²½ ì“°ê³  ì‹¶ì§€ ì•Šì€ ì˜ˆì™¸ì˜ ì˜ì¡´ê´€ê³„ë¥¼ ì°¸ì¡°í•˜ì§€ ì•Šì•„ë„ ë¨
- ë‹¨ì :
    - ì–¸ì²´í¬ ì˜ˆì™¸ëŠ” ê°œë°œìê°€ ì‹¤ìˆ˜ë¡œ ì˜ˆì™¸ë¥¼ ëˆ„ë½ ê°€ëŠ¥
    - ë°˜ë©´ì— ì²´í¬ ì˜ˆì™¸ëŠ” ì»´íŒŒì¼ëŸ¬ë¥¼ í†µí•´ ì˜ˆì™¸ ëˆ„ë½ì„ ì¡ìŒ

# ì²´í¬ ì˜ˆì™¸ í™œìš©

## ê¸°ë³¸ ì›ì¹™ 2ê°€ì§€

1. ê¸°ë³¸ì ìœ¼ë¡œ ì–¸ì²´í¬(ëŸ°íƒ€ì„) ì˜ˆì™¸ë¥¼ ì‚¬ìš©
2. ì²´í¬ ì˜ˆì™¸ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìƒ ì˜ë„ì ìœ¼ë¡œ ë˜ì§€ëŠ” ì˜ˆì™¸ì—ë§Œ ì‚¬ìš©
    1. ì²´í¬ ì˜ˆì™¸ë¡œ ë§Œë“¤ì–´ ë‘ë©´ ì»´íŒŒì¼ëŸ¬ë¥¼ í†µí•´ ë†“ì¹œ ì˜ˆì™¸ë¥¼ ì¸ì§€ ê°€ëŠ¥

## ì²´í¬ ì˜ˆì™¸ì˜ ë¬¸ì œì 

![Untitled 1](https://user-images.githubusercontent.com/61227459/187442134-41d66de9-ffc9-42cc-b854-b731054b1b4d.png)

- ServiceëŠ” `SQLException`ì´ë‘ `ConnectException`ì„ ì²˜ë¦¬í•  ë°©ë²•ì„ ëª¨ë¦„
    - ì‹¬ê°í•œ ë¬¸ì œë“¤ì€ ëŒ€ë¶€ë¶„ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì—ì„œ ì²˜ë¦¬í•  ë°©ë²•ì´ ì—†ìŒ
- Exceptionë“¤ì„ ë˜ì§€ë©´ (ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë©´) ì„œë¸”ë¦¿ì˜ ì˜¤ë¥˜ í˜ì´ì§€ë‚˜, ë˜ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” `ControllerAdvice`ì—ì„œ ì´ëŸ° ì˜ˆì™¸ë¥¼ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬
    - í•´ê²°ì´ ë¶ˆê°€ëŠ¥í•œ ê³µí†µ ì˜ˆì™¸ëŠ” ë³„ë„ì˜ ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ë‚¨ê¹€
    - ê°œë°œìê°€ ì˜¤ë¥˜ë¥¼ ë¹¨ë¦¬ ì¸ì§€í•  ìˆ˜ ìˆë„ë¡ ë©”ì¼, ì•Œë¦¼(ë¬¸ì, ìŠ¬ë™)ë“±ì„ í†µí•´ì„œ ì „ë‹¬

## ë¬¸ì œ 2ê°€ì§€

1. ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸
2. ì˜ì¡´ ê´€ê³„ì— ëŒ€í•œ ë¬¸ì œ

### ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸

- ì´ëŸ° ë¬¸ì œë“¤ì€ ì¼ê´€ì„± ìˆê²Œ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬
- ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  ê°œë°œìê°€ í•´ë‹¹ ì˜¤ë¥˜ë¥¼ ë¹ ë¥´ê²Œ ì¸ì§€í•˜ëŠ” ê²ƒì´ í•„ìš”
- `ControllerAdvice` ì‚¬ìš©

### ì˜ì¡´ ê´€ê³„ì— ëŒ€í•œ ë¬¸ì œ

![Untitled 2](https://user-images.githubusercontent.com/61227459/187442141-cb10f517-34a0-48a7-bfb4-bd75143b3173.png)

- OCP, DIë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì˜ ë³€ê²½ ì—†ì´ ëŒ€ìƒ êµ¬í˜„ì²´ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ì²´í¬ ì˜ˆì™¸ ë•Œë¬¸ì— ë°œëª©ì„ ì¡ìŒ

```java
@Test
void checked() {
	Controller controller = new Controller();
	assertThatThrownBy(() -> controller.request())
									.isInstanceOf(Exception.class);
}
static class Controller {
	Service service = new Service();
	public void request() throws SQLException, ConnectException {
		service.logic();
	}
}
static class Service {
	Repository repository = new Repository();
	NetworkClient networkClient = new NetworkClient();
	public void logic() throws SQLException, ConnectException {
		repository.call();
		networkClient.call();
	}
}
static class NetworkClient {
	public void call() throws ConnectException {
		throw new ConnectException("ì—°ê²° ì‹¤íŒ¨");
	}
}
static class Repository {
	public void call() throws SQLException {
		throw new SQLException("ex");
	}
}
```

# ì–¸ì²´í¬ ì˜ˆì™¸ í—ˆìš©

![Untitled 3](https://user-images.githubusercontent.com/61227459/187442144-98e1085e-4cf5-4c50-97f9-ca498db5fd24.png)

```java
static class NetworkClient {
	public void call() {
		throw new RuntimeConnectException("ì—°ê²° ì‹¤íŒ¨");
	}
}

static class Repository {
	public void call() {
		try {
			runSQL();
		} catch (SQLException e) {
			// ëŸ°íƒ€ì„ìœ¼ë¡œ ë°”ê¿”ì„œ ë©”ì„¸ì§€ë¥¼ ë˜ì§
			throw new RuntimeSQLException(e);
		}
	}
	private void runSQL() throws SQLException {
		throw new SQLException("ex");
	}
}

// ì–¸ì²´í¬ ìƒì„± (RuntimeException ê¸°ë°˜)
static class RuntimeConnectException extends RuntimeException {
	public RuntimeConnectException(String message) {
		super(message);
	}
}

static class RuntimeSQLException extends RuntimeException {
	public RuntimeSQLException() {
	}
	// Throwable cause : ì´ì „ ì˜ˆì™¸ë¥¼ í¬í•¨í•´ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ (SQLExceptionê¹Œì§€)
	public RuntimeSQLException(Throwable cause) {
		super(cause);
	}
}
```

1. ëŒ€ë¶€ë¶„ ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸
    1. ì„œë¹„ìŠ¤ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ëŸ° ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ë¥¼ ì‹ ê²½ ì“°ì§€ ì•Šì•„ë„ ë¨
    2. ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ëŠ” ì¼ê´€ì„± ìˆê²Œ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬
2. ì˜ì¡´ ê´€ê³„ì— ëŒ€í•œ ë¬¸ì œ
    1. ì²´í¬ ì˜ˆì™¸ì²˜ëŸ¼ ì˜ˆì™¸ë¥¼ ê°•ì œë¡œ ì˜ì¡´í•˜ì§€ ì•Šì•„ë„ ë¨

![Untitled 4](https://user-images.githubusercontent.com/61227459/187442147-35c9a543-ab41-4ff8-b23d-86c90e39f575.png)

- ëŸ°íƒ€ì„ ì˜ˆì™¸ëŠ” ë¬¸ì„œí™”ë¥¼ í•´ì•¼ í•¨

# ì˜ˆì™¸ í¬í•¨ê³¼ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤

```java
@Test
void printEx() {
	Controller controller = new Controller();
	try {
		controller.request();
	} catch (Exception e) {
		//e.printStackTrace();
		log.info("ex", e);
	}
}
```

- ì‹¤ë¬´ì—ì„œëŠ” í•­ìƒ ë¡œê·¸!
    - ë¡œê·¸ë¥¼ ì¶œë ¥í•  ë•Œ ë§ˆì§€ë§‰ íŒŒë¼ë¯¸í„°ì— ì˜ˆì™¸ë¥¼ ë„£ì–´ì£¼ë©´ ë¡œê·¸ì— ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ì¶œë ¥

## ê¸°ì¡´ ì˜ˆì™¸ë¥¼ í¬í•¨í•˜ì§€ ì•Šì€ ê²½ìš°

```java
public void call() {
	try {
		runSQL();
	} catch (SQLException e) {
		throw new RuntimeSQLException(); //ê¸°ì¡´ ì˜ˆì™¸(e) ì œì™¸
	}
}
```

- ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ í™•ì¸ ë¶ˆê°€
    - `RuntimeSQLException()`ë¶€í„° ì˜ˆì™¸ í™•ì¸ ê°€ëŠ¥ â†’ DBì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ í™•ì¸ ë¶ˆê°€