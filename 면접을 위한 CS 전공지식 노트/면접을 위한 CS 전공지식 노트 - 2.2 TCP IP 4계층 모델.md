# 면접을 위한 CS 전공지식 노트 - 2.2 TCP/IP 4계층 모델

<aside>
💡 인터넷 프로토콜 스위트 : 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜의 집합

</aside>

# 계층 구조

![Untitled](https://user-images.githubusercontent.com/61227459/197529941-26e91cb7-8737-4c5d-a67f-286bc71ea3cd.png)

## 애플리케이션 계층

FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용되는 프로토콜 계층

## 전송 계층

송신자와 수신자를 연결하는 통신 서비스를 제공

연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공

애플리케이션과  인터넷 계층 사이의  데이터가 전달될 때의 중계 역할

### TCP

패킷 사이의 순서를 보장

연결지향 프로토콜 사용하여 신뢰성을 구축

**가상회선 패킷 교환 방식** 사용

- 각 패킷에는 가사회선 식별자가 포함되며 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착

**3-way handshake (SYNchronization / ACKnowledgement / Initial Sequence Numbers)**

1. SYN : 서버에 클라이언트의 ISN을 담아 SYN 전송 
2. SYN + ACK : 클라이언트의 SYN을 수신하고 서버의 ISN을 송신하며 승인번호로 클라이언트의 ISN + 1 보냄
3. ACK : 서버의 ISN + 1한 값인 승인번호를 담아 ACK를 서버에 보냄

**4-way handshake**

1. FIN으로 설정된 세그먼트 서버로 전송 후 FIN_WAIT_1 상태에서 대기
2. ACK라는 승인 세그먼트를 클라이언트로 전송 후 CLOSE_WAIT 상태에서 대기 / 클라이언트에서 받으면 FIN_WAIT_2 상태에서 대기
3. ACK를 보내고 일정 시간 이후에 클라이언트에 FIN 세그먼트를 보냄
4. 클라이언트는 TIME_WAIT 되고 서버로 ACK를 보내서 서버는 CLOSED 상태

<aside>
💡 TIME_WAIT : 
지연 패킷이 발생할 경우 대비 → 패킷이 뒤늦게 도달해 처리 못하면 데이터 무결성 문제 발생
연결이 닫혔는지 확인하기 위함 → LAST_ACK 상태에서 닫으면 새로운 연결 시 LAST_ACK만 보게 됨

</aside>

### UDP

순서를 보장하지 않음

수신 여부를 확인하지 않음

**데이터그램 패킷 교화 방식** 사용

- 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 순서가 다를 수 있음

## 인터넷 계층

장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송

IP, ARP, ICMP 있음

## 링크 계층

전선, 광섬유, 무선 등으로 실질적으로 데이터 전달

물리 계층 : 무선 LAN, 유선 LAN

데이터 링크 계층 : 이더넷 프레임을 통해 에러 확인, 흐름 제어, 접근 제어 담당

### 유선 LAN(IEEE802.3)

**전이주화 통신**

- 양쪽 장치가 동시에 송수신 할 수 있는 방식

**CSMA/CD**

- 반이중화 통신
- 데이터를 보낸 이후 충돌이 발생하면 일정 시간 이후 재전송
- 경로 기반으로 데이터를 보내기 때문에 충돌을 대비해야 함

### 유선 LAN을 이루는 케이블

**TP 케이블 (twisted pair cable)**

- 여덟개의 구리선을 두 개씩 꼬아서 묶은 케이블
- 실드 처리하지 않고 덮은 UTP 케이블과 실드 처리하고 덮은 STP로 나눠짐
- LAN 케이블이 UTP 케이블

**광섬유 케이블**

- 레이저를 통해 통신
- 빛의 굴절률이 높은 부분을 코어, 낮은 부분을 클래딩

### 무선 LAN(IEEE802.11)

**반이중화 통신**

- 한 번에 한 방향만 통신

**CSMA/CA**

1. 데이터를 송신하기 전에 무선 매체를 살핌
2. 캐리어 감지 : 회선이 비어있는지 판단
3. IFS(Inter FrameSpace) : 랜덤 값을 기반으로 정해진 시간만큼 기다리며, 만약 무선 매체가 사용중이면 점차 그 간격을 늘려가며 기다림
4. 데이터 송신

### **무선 LAN을 이루는 주파수**

2.4GHz : 장애물에 강하지만 전자레인지, 무선 등 전파 간섭이 일어남

5GHz : 사용할 수 있는 채널 수도 많고 동시에 사용 가능

**와이파이**

- 사용하려면 무선 접속 장치(AP : access point)가 있어야 함
- 공유기가 유선 → 무선

**BSS (Basic Service Set)**

- 기본 서비스 집합
- 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조
- 근거리 무선 통신 제공

**ESS (Extended Service Set)**

- 하나 이상의 연결된 BSS 그룹
- 장거리 무선 통신 제공

![Untitled 1](https://user-images.githubusercontent.com/61227459/197529928-ce84bf64-2d47-4129-a43e-f7c31ad17531.png)

### 이더넷 프레임

![Untitled 2](https://user-images.githubusercontent.com/61227459/197529937-389da79a-a4d2-497d-bed5-2ea1caa71d68.png)

- Preamble : 프레임 시작
- SFD : 이 다음부터 MAC 주소 알림
- DMAC, SMAC : 수신, 송신 MAC
- EtherType : 데이터 계층 위의 계층인 IP 프로토콜 정의 (IPv4 또는 IPv6)
- Payload : 전달받은 데이터
- CRC : 에러 확인 버튼

# 계층 간 데이터 송수신 과정

## 캡슐화 과정

상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입

프레임 헤더 - IP 헤더 - TCP 헤더 - 데이터 - 프레임 트레일러

데이터 → 세그먼트/데이터그램 → 패킷 → 프레임

## 비캡슐화 과정

각 계층의 헤더 부분을 제거

# PDU (Protocol Data Unit)

제어 관련 정보 : 헤더

데이터 : 페이로드

애플리케이션 계층 : 메시지

전송 계층 : 세그먼트(TCP), 데이터그램(UDP)

인터넷 계층 : 패킷

링크 계층 : 프레임(데이터 링크 계층), 비트(물리 계층)